<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
<th:block th:replace="fragments/import :: info-header" />
<th:block th:replace="fragments/import :: css-header" />
<th:block th:replace="fragments/import :: js-header" />
<link href="css/jquery-ui.min.css" th:href="@{/css/richtext.min.css}"
	rel="stylesheet">

<script th:src="@{/js/autoNumeric.min.js}"></script>
</head>

<body id="page-top">
	<th:block th:replace="fragments/general :: navbar-header" />

	<div id="wrapper">
		<th:block th:replace="fragments/general :: menu" />

		<div id="content-wrapper">
			<div class="container-fluid">
				<th:block th:replace="fragments/general :: panel-page" />

				<div id="cart" class="card mb-3">
					<div id="divContentHeader" class="card-header">
						<b><span id="titlePage" th:text="${titlePage}"></span></b>
					</div>					
					<div id="alertSuccess" class="alert alert-success"
						style="display: none;">
						<strong>Success!</strong> <span id="alertSuccessMsg"
							th:text="${M_0005}"></span>
					</div>
					<div id="alertFailed" class="alert alert-danger"
						style="display: none;">
						<strong>Failed!</strong> <span id="alertFailedMsg"></span>
					</div>
					
					<div id="claimsIndex">
						<div class="card-body">
						
							<div class="card mb-3">
								<div class="card-body">
									<div class="row">
										<div class="col-md-3">
											<strong><label>Create Internal Memo</label></strong>
										</div>
									</div>
									<div class="row">
										<div class="col-md-1">
											<label>Received</label>
										</div>
										<div class="row col-md-5">
											<div class="col-md-5">
												<div class="input-group">
													<input id="internalMemoStart" name="internalMemoStart" type="text" class="form-control" disabled>
													<div class="input-group-append">
														<button id='btnInternalMemoStart' class="btn btn-primary" type="button">
															<i class="fas fa-calendar"></i>
														</button>
													</div>
												</div>
											</div>	
											- 
											<div class="col-md-5">
												<div class="input-group">
													<input id="internalMemoEnd" name="internalMemoEnd" type="text" class="form-control" disabled>
													<div class="input-group-append">
														<button id='btnInternalMemoEnd' class="btn btn-primary" type="button">
															<i class="fas fa-calendar"></i>
														</button>
													</div>
												</div>
											</div>	
										</div>
										<div class="col-md-1">
											<button id="btnInternalMemo" class="btn btn-success col-md-12">Memo</button>
										</div>
									</div>
								</div>
							</div>
							
							<br>
						
							<div class="row justify-content-end">
								<div class="col-md-2">
									<button id="btnExport" class="btn btn-success col-md-12">Export</button>
								</div>
								<div class="col-md-2">
									<button id="btnCreate" class="btn btn-primary col-md-12">Create</button>
								</div>
							</div>
						
							<br>
						
							<div class="row justify-content-end">
								<div class="col-md-2">
									<select name="filterYear" id="filterYear" class="form-control col-md-12">
										<option value="ALL"></option>
									</select>
								</div>
								<div class="col-md-2">
									<select name="filterStatus" id="filterStatus" class="form-control col-md-12">
										<option value="ALL">ALL</option>
									</select>
								</div>
								<div class="input-group col-md-4">
									<input id="filterSearch" name="filterSearch"
										type="text" class="form-control">
									<div class="input-group-append">
										<button class="btn btn-primary" type="button"
											onclick="inquiryClaims()">
											<i class="fas fa-search"></i>
										</button>
									</div>
								</div>
							</div>
							
							<br>
								
							<table id="tableClaims" data-toolbar-align="right" data-toggle="table"
								data-sortable="true" data-url="" data-side-pagination="server"
								data-pagination="true" data-page-size="5" data-unique-id="idKey"
								data-pagination-v-align="top" data-page-list="[5, 10, 25, 50, ALL]">
								<thead>
									<tr>
										<th data-field="createOnStr" data-sortable="true">Date</th>
										<th data-field="txType">Type</th>
										<th data-field="txVoucherId" data-sortable="true">Voucher</th>
										<th data-field="txClientCode" data-sortable="true">Client</th>
										<th data-field="txCoverId" data-sortable="true">Product</th>
										<th data-field="txInterest">Description</th>
										<th data-field="txPolicyNo">Policy No</th>
										<th data-field="txInsCode" data-sortable="true">Insurer</th>
										<th data-field="txPartyName" data-sortable="true">Participant</th>
										<th data-field="txCurrId">Curr</th>
										<th data-field="txSumInsStr" data-halign="right" data-align="right">Sum Insured</th>
										<th data-field="txDataStatusVal" data-sortable="true">Status</th>
										<th data-field="action">Action</th>
									</tr>
								</thead>
							</table>
						</div>
					</div>			
					
					<div id="claimsCreate" hidden="true">
						<div class="card-body">
						
							<div class="row justify-content-end">
								<div class="col-md-2">
									<button id="btnBack2" class="btn btn-danger col-md-12" onclick="back()">
										<i class="fa fa-chevron-left"></i> Back
									</button>
								</div>
							</div>
						
							<div class="row">
								<div class="col-md-2">
									<label>COB</label>
								</div>
								<div class="col-md-3">
									<select name="cob" id="cob" class="form-control" required>
										<option value="ALL">ALL</option>
									</select>
								</div>
							</div>
							
							<br>
							
							<div class="row">
								<div class="col-md-2">
									<label>Client</label>
								</div>
								<div class="col-md-3">
									<div class="input-group">
										<input id="clientDesc" name="clientDesc" type="text"
											class="form-control" disabled> 
										<input id="client" name="client" type="text" 
											class="form-control" hidden="true" disabled/>
				
										<div class="input-group-append">
											<button id='btnClientSearch' class="btn btn-primary"
												type="button" data-toggle="modal"
												data-target="#client-modal">
												<i class="fas fa-search"></i>
											</button>
										</div>
									</div>
								</div>
							</div>
							
							<br>
							<br>
							
							<th:block th:replace="fragments/button :: btn-search-reset" />
							
							<br>
							
							<table id="tableCreate" data-toolbar-align="right" data-toggle="table"
								data-sortable="true" data-url="" data-side-pagination="server"
								data-pagination="true" data-page-size="5" data-unique-id="idKey"
								data-pagination-v-align="top" data-page-list="[5, 10, 25, 50, ALL]">
								<thead>
									<tr>
										<th data-field="trxClassDesc" data-sortable="true">Class</th>
										<th data-field="trxTrxId" data-sortable="true">Type</th>
										<th data-field="trxVoucherId" data-sortable="true">Voucher</th>
										<th data-field="trxCoverCode" data-sortable="true">COB</th>
										<th data-field="trxRemarks">Policy No</th>
										<th data-field="period">Period</th>
										<th data-field="trxClientDesc" data-sortable="true">Client/Cedant</th>
										<th data-field="trxInsuredName">Description</th>
										<th data-field="trxCurrId" data-sortable="true">Curr</th>
										<th data-field="trxTsiAmountStr" data-halign="right" data-align="right" data-sortable="true">Sum Insured</th>
									</tr>
								</thead>
							</table>
						</div>
					</div>
					
					<div id="claimsDetail" hidden="true">
						<div class="card-body">
						
						<div class="row justify-content-end">
							<div class="col-md-2">
								<button id="btnBack2" class="btn btn-danger col-md-12" onclick="back()">
									<i class="fa fa-chevron-left"></i> Back
								</button>
							</div>
						</div>
						
						<div id="divTableDetail">
							<br>
													
							<div class="row justify-content-end">
								<div class="input-group col-md-4">
									<input id="filterDetailSearch" name="filterDetailSearch"
										type="text" class="form-control">
									<div class="input-group-append">
										<button class="btn btn-primary" type="button"
											onclick="inquiryCreateDetails()">
											<i class="fas fa-search"></i>
										</button>
									</div>
								</div>
							</div>
							
							<br>
						
							<table id="tableCreateDetail" data-toolbar-align="right" data-toggle="table"
								data-sortable="true" data-url="" data-side-pagination="server"
								data-pagination="true" data-page-size="5" data-unique-id="idKey"
								data-pagination-v-align="top" data-page-list="[5, 10, 25, 50, ALL]">
								<thead>
									<tr>
										<th data-field="trxBrdxId" data-sortable="true">The Insured/Bordeoux</th>
										<th data-field="trxPartyName">Name</th>
										<th data-field="period">Period</th>
										<th data-field="trxCurrId" data-sortable="true">Curr</th>
										<th data-field="trxTsiAmountStr" data-halign="right" data-align="right" data-sortable="true">Sum Insured</th>
										<th data-field="trxBenefit">Benefit</th>
										<th data-field="fileName">File Name</th>
										<th data-field="trxClaimStatusVal">Status</th>
									</tr>
								</thead>
							</table>
						</div>
						
						<br>
						
						<div class="card-body">
							<ul class="nav nav-tabs" id="myTab" role="tablist">
								<li class="nav-item"><a class="nav-link active"
									id="client-information-tab" data-toggle="tab"
									href="#clientInformationTab" role="tab"
									aria-controls="clientInformationTab" aria-selected="true">Client
										Information</a></li>
								<li class="nav-item"><a class="nav-link"
									id="claim-tab" data-toggle="tab"
									href="#claimTab" role="tab"
									aria-controls="claimTab" aria-selected="false">Claim</a></li>
								<li class="nav-item"><a class="nav-link"
									id="underwriting-tab" data-toggle="tab"
									href="#underwritingTab" role="tab"
									aria-controls="underwritingTab" aria-selected="false">Underwriting</a></li>
								<li class="nav-item"><a class="nav-link"
									id="value-tab" data-toggle="tab"
									href="#valueTab" role="tab"
									aria-controls="valueTab" aria-selected="false">Value</a></li>
								<li class="nav-item"><a class="nav-link"
									id="memoAndAction-tab" data-toggle="tab"
									href="#memoAndActionTab" role="tab"
									aria-controls="memoAndAction" aria-selected="false">Memo And Action</a></li>
								<li class="nav-item"><a class="nav-link"
									id="document-tab" data-toggle="tab"
									href="#documentTab" role="tab"
									aria-controls="documentTab" aria-selected="false">Document</a></li>
								<li class="nav-item"><a class="nav-link"
									id="finance-tab" data-toggle="tab"
									href="#financeTab" role="tab"
									aria-controls="finance" aria-selected="false">Finance</a></li>
							</ul>
							<div class="tab-content" id="myTabContent">
								<div class="tab-pane fade show active" id="clientInformationTab"
									role="tabpanel" aria-labelledby="client-information-tab">

									<th:block
										th:replace="fragments/claimsInternal/clientInformation :: client-information-tab" />

								</div>
								<div class="tab-pane fade" id="claimTab" role="tabpanel"
									aria-labelledby="claim-tab">
									<th:block
										th:replace="fragments/claimsInternal/claim :: claims-tab" />
								</div>
								<div class="tab-pane fade" id="underwritingTab" role="tabpanel"
									aria-labelledby="underwriting-tab">
									<th:block
										th:replace="fragments/claimsInternal/underwriting :: underwriting-tab" />
								</div>
								<div class="tab-pane fade" id="valueTab" role="tabpanel"
									aria-labelledby="value-tab">
									<th:block
										th:replace="fragments/claimsInternal/value :: value-tab" />
								</div>
								<div class="tab-pane fade" id="memoAndActionTab" role="tabpanel"
									aria-labelledby="memoAndAction-tab">
									<th:block
										th:replace="fragments/claimsInternal/memo :: memo-tab" />
								</div>
								<div class="tab-pane fade" id="documentTab" role="tabpanel"
									aria-labelledby="document-tab">
									<th:block
										th:replace="fragments/claimsInternal/document :: document-tab" />
								</div>
								<div class="tab-pane fade" id="financeTab" role="tabpanel"
									aria-labelledby="finance-tab">
									<th:block
										th:replace="fragments/claimsInternal/finance :: finance-tab" />
								</div>
							</div>
						</div>
						
						<th:block th:replace="fragments/button :: btn-save-cancel" />
						
						</div>				
					</div>
				</div>

				<!-- Modal Validation -->
				<div class="modal fade" id="validation-modal" tabindex="-1"
					role="dialog" aria-labelledby="validation-modal" aria-hidden="true">
					<div class="modal-dialog modal-lg" role="document">
						<div class="modal-content">
							<div class="modal-header">
								<h5 class="modal-title" id="client-modal-label">Validation</h5>
								<button type="button" class="close" data-dismiss="modal"
									aria-label="Close">
									<span aria-hidden="true">&times;</span>
								</button>
							</div>
							<div class="modal-body">
								
							<div class="row">
								<div class="col-md-10">
									<label><b>Claim</b></label>
								</div>
								<div class="col-md-10">
									<label id="validationTabClaim"></label>
								</div>
							</div>
								
							</div>
						</div>
					</div>
				</div>
				<!-- Modal Validation -->

			</div>
			<!-- /.container-fluid -->
			<th:block th:replace="fragments/general :: copyright-footer"></th:block>
		</div>
		<!-- /.content-wrapper -->
	</div>
	<!-- /#wrapper -->

	<th:block th:replace="fragments/general :: scroll-to-top" />
	<th:block th:replace="fragments/general :: logout-modal" />
	<th:block th:replace="fragments/import :: js-body" />
	<th:block th:replace="fragments/modal :: confirmation-save" />
	<th:block th:replace="fragments/modal :: confirmation-delete" />
	
	<!-- Modal Client -->
	<div class="modal fade" id="client-modal" tabindex="-1"
		role="dialog" aria-labelledby="client-modal" aria-hidden="true">
		<div class="modal-dialog modal-lg" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="client-modal-label">Client</h5>
					<button id="btnCloseClientModal" type="button" class="close" data-dismiss="modal"
						aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<div class="row card-body justify-content-end">
						<div class="col-md-3">
							<select id="clientSelector" name="clientSelector"
								class="custom-select">
								<option value="cliName">Name</option>
								<option value="cliCode">Client Id</option>
							</select>
						</div>
						<div class="input-group col-md-3">
							<input id="clientFilterValue" type="text" class="form-control">
							<div class="input-group-append">
								<button id="clientFilterSearchBtn" class="btn btn-primary"
									type="button" onclick="clientFilteredSearch()">
									<i class="fas fa-search"></i>
								</button>
							</div>
						</div>
					</div>
					
					<table id="tableClient" data-toggle="table" data-url=""
						data-sortable="true" data-side-pagination="server"
						data-pagination="true" data-page-size="5"
						data-page-list="[5, 10, 25, 50, ALL]"
						data-pagination-V-Align="top">
						<thead>
							<tr>
								<th data-field="cliCode" data-sortable="true">Client ID</th>
								<th data-field="cliName" data-sortable="true">Client
									Name</th>
								<th data-field="cliTypeDesc">Type</th>
								<th data-field="cliDataStatusStr">Status</th>
							</tr>
						</thead>
					</table>
				</div>
			</div>
		</div>
		<script type="text/javascript" th:inline="javascript">
			$('#clientSelector').select2({width : '100%'});
		
			$('#btnCloseClientModal').click(function() {
				$('#client').val('');
				$('#clientDesc').val('').trigger('change');
			});
				
			$('#btnClientSearch').click(function() {			
				$('#clientFilterValue').val('');
				$('#clientSelector').val('cliName').trigger('change');
				
				var url = /*[[@{/static-data/client}]]*/;
				url = url + "?cliType=1";
				$('#tableClient').bootstrapTable('refreshOptions', {
				    theadClasses: 'thead-dark',
				    url: url
				});
			});
	
			$('#tableClient').on('click-row.bs.table',function(e, row, $tr) {
				$('#client').val(row.cliCode);
				$('#clientDesc').val(row.cliName).trigger('change');
				$('#client-modal').modal('hide');
			});
		
			function clientFilteredSearch() {
				var url = /*[[@{/static-data/client}]]*/;
				var filterKey = $("#clientSelector").select2('val');
				var filterValue = $("#clientFilterValue").val();
				
				url = url + "?cliType=1";
				if(filterValue != "")
					url = url + "&filterKey="+filterKey+"&filterValue="+filterValue;
				
				$('#tableClient').bootstrapTable('refreshOptions', {
				    theadClasses: 'thead-dark',
				    url: url
				});
			}
		</script>
	</div>
	<!-- /Modal Client -->
	
</body>

<script type="text/javascript" th:inline="javascript">
	/*<![CDATA[*/
		
		var tr6;
		var modify;
		var oldReinsNo = 1;
		
		const formatter_2 = new Intl.NumberFormat('en-US', {
			style: 'currency',
			currency: 'USD',
			minimumFractionDigits: 2
		});

		const formatter_4 = new Intl.NumberFormat('en-US', {
  			style: 'currency',
  			currency: 'USD',
  			minimumFractionDigits: 4
		});
		
		$('#internalMemoStart').datepicker({
			dateFormat: 'dd/mm/yy',
			changeMonth: true,
			changeYear: true
		}).datepicker('setDate', [[${appDate}]]);
		$('#internalMemoEnd').datepicker({
			dateFormat: 'dd/mm/yy',
			changeMonth: true,
			changeYear: true,
			minDate: [[${appDate}]]
		}).datepicker('setDate', [[${appDate}]]);
		
		$('#btnInternalMemoStart').click(function(){
			$('#internalMemoStart').datepicker('show');
		});
		$('#btnInternalMemoEnd').click(function(){
			$('#internalMemoEnd').datepicker('show');
		});
		$('#internalMemoStart').change(function() {
			$('#internalMemoEnd').datepicker('option','minDate', $('#internalMemoStart').val());
		});
		
		function create_UUID() {
		    var dt = new Date().getTime();
		    var uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
		        var r = (dt + Math.random()*16)%16 | 0;
		        dt = Math.floor(dt/16);
		        return (c=='x' ? r :(r&0x3|0x8)).toString(16);
		    });
		    return uuid;
		}
		
		$(function() {	
			var urlYear = /*[[@{/marketing/claims-internal/dropdown-year}]]*/;
			rest('GET', urlYear).done(function(data) {
				$('#filterYear').select2({width : '100%', data : data});
			});
			
			var urlStatus = /*[[@{/static-data/dropdown-param}]]*/;
			rest('GET', urlStatus + "?parentCode=STDATA&childValue=8,16,17,18,20").done(function(data) {
				$('#filterStatus').select2({width : '100%', data : data});
			});
			
			rest('GET', /*[[@{/marketing/direct-modify/get-dropdownTypeOfCover}]]*/).done(function(data) {
				$('#cob').select2({width : '100%', data : data});
			});
		});
		
		// ========== EVENT ========== //
		
		$('#btnCreate').click(function() {			
			$('#claimsCreate').removeAttr('hidden');
			$('#claimsIndex').attr('hidden', true);
			
			$('#titlePage').text(/*[[${titlePageCreate}]]*/);
		});
		
		$('#btnSearch').click(function() {
			inquiryCreate();
		});
		
		$('#btnReset').click(function() {
			resetCreate();
		});
		
		$('#btnSave').click(function() {
			var isProcess = validate();
			
			if(!isProcess)
				return false;
			
			doSave(false);
		});
		
		$('#tableCreate').on('click-row.bs.table',function(e, row, $tr) {
			$('#claimsDetail').removeAttr('hidden');
			$('#claimsCreate').attr('hidden', true);
			
			tr6 = row;
			
			$('#t1OldTrxType').val(tr6.trxTrxId);			//VAR_A
			$('#t1OldTrxVoucherId').val(tr6.trxVoucherId);  //VAR_B
			
			setT3();

			$('#t1ClientId').val(tr6.trxClient);
			$('#t1ClientName').val(tr6.trxClientDesc);
			$('#t1PolicyNo').val(tr6.trxRemarks);
			$('#t1Toc').val(tr6.trxCoverCode);
			$('#t1PeriodStart1').val(tr6.trxInsStart);
			$('#t1PeriodEnd1').val(tr6.trxInsEnd);
			
			if(row.source == 'N') {
				$('#t4or').prop('disabled', false);
				$('#t4qs').prop('disabled', false);
				$('#t4ur').prop('disabled', false);
				$('#t4claimsC').prop('disabled', false);
				$('#t4claimsR').prop('disabled', false);
				$('#t4reinsPremiC').prop('disabled', false);
				$('#t4reinsPremiR').prop('disabled', false);
			}else {
				$('#t4or').prop('disabled', true);
				$('#t4qs').prop('disabled', true);
				$('#t4ur').prop('disabled', true);
				$('#t4claimsC').prop('disabled', true);
				$('#t4claimsR').prop('disabled', true);
				$('#t4reinsPremiC').prop('disabled', true);
				$('#t4reinsPremiR').prop('disabled', true);
			}
			
			oldReinsNo = 1;
			$('#t7EntryDate').datepicker('setDate', /*[[${appDate}]]*/);				
			getExchangeDateCurr(/*[[${appDate}]]*/, tr6.trxCurrId).done(function(exchange) {
				AutoNumeric.getAutoNumericElement('#t7ExchangeRate1').set(exchange);
				AutoNumeric.getAutoNumericElement('#t7ExchangeRate2').set(exchange);
			});
		});
		
		$('#tableCreateDetail').on('click-row.bs.table',function(e, row, $tr) {
			$('#t1ParticipantName').val(row.trxPartyName);
			$('#t1ParticipantId').val(row.trxBrdxId);
			$('#t1Borderoux').val(row.trxBrdxId);
			$('#t1PeriodStart2').val(row.trxNewStartF);
			$('#t1PeriodEnd2').val(row.trxNewEndF);
			var ii = row.trxInterest;
			if(ii === '' || ii == null)
				ii = tr6.trxInsInsured;
			
			$('#t1InterestInsured').val(ii);
			$('#t1CurrId').val(row.trxCurrId);
			AutoNumeric.getAutoNumericElement('#t1SumInsured').set(row.trxTsiAmountStr);
			$('#t1Status').val(row.trxClaimStatusVal);
			
			$('#t1TxVoucherId').val('');
			$('#t1RelatedKeyId').val(row.idKey);
			$('#t4remarks2').val(row.fileName);
		});
		
		// ========== FUNCTION ========== //
		
		function inquiryClaims() {
			var search = $('#filterSearch').val();
			var status = $('#filterStatus').val();
			var year = $('#filterYear').val();
			
			if(status === 'ALL')
				status = '';
			
			if(year === 'ALL')
				year = '';
			
			var urlInq = /*[[@{/marketing/claims-internal/inquiry-data}]]*/;
			urlInq += '?txDataStatus=' + status + '&search=' + search + '&year=' + year;
			
			$('#tableClaims').bootstrapTable('refreshOptions', {
		  		paginationSuccessivelySize: 3,
		        theadClasses: 'thead-dark',
		        url: urlInq
		    });
		}
		
		function inquiryCreate() {
			var client = $('#client').val();
			var cob = $('#cob').val();
			
			if(cob === 'ALL')
				cob = '';
			
			var urlInq = /*[[@{/marketing/claims-internal/inquiry-create}]]*/;
			urlInq += '?client=' + client + '&cob=' + cob;
			
			$('#tableCreate').bootstrapTable('refreshOptions', {
		  		paginationSuccessivelySize: 3,
		        theadClasses: 'thead-dark',
		        url: urlInq
		    });
		}
		
		function inquiryCreateDetails() {
			var search = $('#filterDetailSearch').val();
			
			var urlInq = /*[[@{/marketing/claims-internal/inquiry-create-detail}]]*/;
			urlInq += '?trxTrxId=' + tr6.trxTrxId + '&trxVoucherId=' + tr6.trxVoucherId + '&search=' + search;
			
			$('#tableCreateDetail').bootstrapTable('refreshOptions', {
		  		paginationSuccessivelySize: 3,
		        theadClasses: 'thead-dark',
		        url: urlInq
		    });
		}
		
		function removeClaims(type, voucherId) {
			var isDelete = confirm("Are you sure to delete?");
			
			if(isDelete == true) {
				doRemove(type, voucherId);
			}
		}
		
		function doRemove(type, voucherId) {
			var datas = {
				txType: type,
				txVoucherId: voucherId
			}
			
			return $.ajax({type: 'POST', global: false, dataType: 'json',  
				contentType:'application/json',
				url: /*[[@{/marketing/claims-internal/delete}]]*/, 
				data: JSON.stringify(datas), 
				complete: function (data) {
					if(data.status === 200)
						location.reload();
					else
						showAlertFailed(/*[[${M_0006}]]*/);
				}
			});
		}
		
		function editClaims(idKey, txType, txVoucherId) {			
			var data = {
				txType: txType,
				txVoucherId: txVoucherId
			}
			
			$.ajax({ 
		        type: 'POST',
		        dataType: 'json',
		        contentType: 'application/json',
		        data:JSON.stringify(data),
		        url: /*[[@{/marketing/claims-internal/inquiry-detail}]]*/,
		    }).then(function(result) {   
		    	modify = result;
		    	
				setT1();
				setT2();
				setT3();
				setT4();
				setT5();
				setT6();
				
				if(result.source == 'N') {
					$('#t4or').prop('disabled', false);
					$('#t4qs').prop('disabled', false);
					$('#t4ur').prop('disabled', false);
					$('#t4claimsC').prop('disabled', false);
					$('#t4claimsR').prop('disabled', false);
					$('#t4reinsPremiC').prop('disabled', false);
					$('#t4reinsPremiR').prop('disabled', false);
				}else {
					$('#t4or').prop('disabled', true);
					$('#t4qs').prop('disabled', true);
					$('#t4ur').prop('disabled', true);
					$('#t4claimsC').prop('disabled', true);
					$('#t4claimsR').prop('disabled', true);
					$('#t4reinsPremiC').prop('disabled', true);
					$('#t4reinsPremiR').prop('disabled', true);
				}
		    	
				$('#claimsDetail').removeAttr('hidden');
				$('#claimsIndex').attr('hidden', true);
				$('#divTableDetail').attr('hidden', true);			
				
				$('#t7EntryDate').datepicker('setDate', /*[[${appDate}]]*/);				
				getExchangeDateCurr(/*[[${appDate}]]*/, modify.t1Data.txCurrId).done(function(exchange) {
					AutoNumeric.getAutoNumericElement('#t7ExchangeRate1').set(exchange);
					AutoNumeric.getAutoNumericElement('#t7ExchangeRate2').set(exchange);
				});
				
				$('#titlePage').text(/*[[${titlePageEdit}]]*/);
				
				getValueTR6J();
		    });
		}
		
		function resetCreate() {
			$('#client').val('');
			$('#clientDesc').val('');
			$('#cob').val('ALL').trigger('change');
			
			$('#tableCreate').bootstrapTable('destroy').bootstrapTable();
		}
		
		function doSave(isSaveValue) {
			$('#btnSave').attr('disabled', 'true');
			
			save().done(function(data) {
				var status = data.status;
				if(status == "OK" && !isSaveValue) {
					showAlertSuccess();
					location.reload();
				}else if(isSaveValue) {
					$('#t1TxVoucherId').val(data.result);
					setIdKeyValue();
				}else if(status != "OK") {
					showAlertFailed(/*[[${M_0006}]]*/);
				}

				$('#btnSave').removeAttr('disabled');
			}).fail(function() {
				showAlertFailed(/*[[${M_0006}]]*/);
			    $('#btnSave').removeAttr('disabled');
			});
		}
		
		function save() {
			var txVoucherId = $('#t1TxVoucherId').val();
			var t1Data = getT1Data();
			var t2Data = getT2Data();
			var t4Data = getT4Data();
			var t5Data = getT5Data();
			var t6Data = getT6Data();
			
			var datas = {
				txVoucherId: txVoucherId,
				txOldType: $('#t1OldTrxType').val(),
				txOldVoucherId: $('#t1OldTrxVoucherId').val(),
				createBy: $('#t1CreateBy').val(),
				createOn: $('#t1CreateOn').val(),
				t1Data: t1Data,
				t2Data: t2Data,
				t4Data: t4Data,
				t5Data: t5Data,
				t6Data: t6Data
			}
			
			return $.ajax({type: 'POST', global: false, dataType: 'json', async: false, 
				contentType:'application/json',
				url: /*[[@{/marketing/claims-internal/save}]]*/, 
				data: JSON.stringify(datas), 
				success: function (data) {
				}
			});
		}
		
		function getT1Data() {		
			var txClientId = $('#t1ClientId').val();
			var txPolicyNo = $('#t1PolicyNo').val();
			var txCoverId = $('#t1Toc').val();
			var txPartyName = $('#t1ParticipantName').val();
			var txBrdxId = $('#t1Borderoux').val();
			var txDateFrom = $('#t1PeriodStart2').val();
			var txDateTo = $('#t1PeriodEnd2').val();
			var txInterest = $('#t1InterestInsured').val();
			var txCurrId = $('#t1CurrId').val();
			var txTsiAmount = AutoNumeric.getAutoNumericElement('#t1SumInsured').get();
			var txDataStatus = '16';
			var txAttClient = $('#t1AttentionClient').val();

			var relatedIdKey = $('#t1RelatedKeyId').val();
					
			var t4or = AutoNumeric.getAutoNumericElement('#t4or').get();
			var t4qs = AutoNumeric.getAutoNumericElement('#t4qs').get();
			var t4ur = AutoNumeric.getAutoNumericElement('#t4ur').get();
			var t4claimsC = AutoNumeric.getAutoNumericElement('#t4claimsC').get();
			var t4claimsR = AutoNumeric.getAutoNumericElement('#t4claimsR').get();
			var t4reinsNo = AutoNumeric.getAutoNumericElement('#t4reinsNo').get();
			var t4reinsPremiC = AutoNumeric.getAutoNumericElement('#t4reinsPremiC').get();
			var t4reinsPremiR = AutoNumeric.getAutoNumericElement('#t4reinsPremiR').get();
			
			var t1Data = {
				txClientId: txClientId,
				txPolicyNo: txPolicyNo,
				txCoverId: txCoverId,
				txPartyName: txPartyName,
				txBrdxId: txBrdxId,
				txDateFrom: txDateFrom,
				txDateTo: txDateTo,
				txInterest: txInterest,
				txCurrId: txCurrId,
				txTsiAmount: txTsiAmount,
				txDataStatus: txDataStatus,
				txAttClient: txAttClient,
				relatedIdKey: relatedIdKey,
				t4or: t4or,
				t4qs: t4qs,
				t4ur:t4ur,
				t4claimsC: t4claimsC,
				t4claimsR: t4claimsR,
				t4reinsNo: t4reinsNo,
				t4reinsPremiC: t4reinsPremiC,
				t4reinsPremiR: t4reinsPremiR
			}
			
			return t1Data;
		}
		
		function getT2Data() {		
			var t2LostDate = $('#t2LostDate').val();
			var t2AdviceDate = $('#t2AdviceDate').val();
			var t2UwReff = $('#t2UwReff').val();
			var t2MaxDaysClaim = $('#t2MaxDaysClaim').val();
			var t2Cause = $('#t2Cause').val();
			var t2Details = $('#t2Details').val();
			
			var t2Data = {
				txLostDate: t2LostDate,
				txAdviceDate: t2AdviceDate,
				txUwReff: t2UwReff,
				txMaxPaid: t2MaxDaysClaim,
				txCause: t2Cause,
				txDetails: t2Details
			}
			
			return t2Data;
		}
		
		function getT4Data() {		
			var t4DataTable = $('#t4Table').bootstrapTable('getData');
			
			var t4Data = {
				t4DataTable: t4DataTable
			}
			var t4remarks2 =$('#t4remarks2').val();
			t4Data.t4remarks2 = t4remarks2;
			
			return t4Data;
		}
		
		function getT5Data() {		
			var isReject = $('#t5ClaimsRejection').is(':checked');
			var isCancel = $('#t5ClaimsCancel').is(':checked');
			var isPaid = $('#t5ClaimsPaid').is(':checked');
			var t5DataTable = $('#t5Table').bootstrapTable('getData');
			
			var t5Data = {
				isReject: isReject,
				isCancel: isCancel,
				isPaid: isPaid,
				t5DataTable: t5DataTable
			}
			
			return t5Data;
		}
		
		function getT6Data() {				
			var t6DataTable = $('#t6Table').bootstrapTable('getData');
			
			var t6Data = {
				t6DataTable: t6DataTable
			}
			
			return t6Data;
		}
		
		// ========== ALERT ========== //
		
		function showAlertSuccess() {
			$(location).attr('href', '#page-top');
			$('#alertSuccess').fadeTo(2000, 500).slideUp(500, function() {
				$('#alertSuccess').slideUp(500);
				location.reload();
			});
		}

		function showAlertFailed(msgAlert) {
			$(location).attr('href', '#page-top');
			$('#alertFailedMsg').text(msgAlert);
			$('#alertFailed').fadeTo(3000, 500).slideUp(500, function() {
				$('#alertFailed').slideUp(500);
				$('#btnModalYesDelete').removeAttr('disabled')
				$('#btnModalYes').removeAttr('disabled')
			});
		}
		
		// ========== SET ========== //
		
		function setT1() {
			var t1Data = modify.t1Data;
			
			$('#t1ClientId').val(t1Data.txClientId);
			$('#t1ClientName').val(t1Data.txClientCode);
			$('#t1PolicyNo').val(t1Data.txPolicyNo);
			$('#t1Toc').val(t1Data.txCoverId);
			$('#t1PeriodStart1').val(t1Data.period1Start);
			$('#t1PeriodEnd1').val(t1Data.period1End);
			$('#t1ParticipantName').val(t1Data.txPartyName);
			$('#t1ParticipantId').val(t1Data.txBrdxId);
			$('#t1Borderoux').val(t1Data.txBrdxId);
			$('#t1PeriodStart2').val(t1Data.period2Start);
			$('#t1PeriodEnd2').val(t1Data.period2End);			
			$('#t1InterestInsured').val(t1Data.txInterest);
			$('#t1CurrId').val(t1Data.txCurrId);
			AutoNumeric.getAutoNumericElement('#t1SumInsured').set(t1Data.txSumInsStr);
			$('#t1Status').val(t1Data.txDataStatusVal);
			$('#t1StatusCode').val(t1Data.txDataStatus);
			$('#t1AttentionClient').val(t1Data.txAttClient);
			
			$('#t1TxVoucherId').val(t1Data.txVoucherId);
			$('#t1OldTrxType').val(t1Data.txOldType);
			$('#t1OldTrxVoucherId').val(t1Data.txOldVoucherId);
			$('#t1RelatedKeyId').val(t1Data.relatedIdKey);
			$('#t1CreateBy').val(modify.createBy);
			$('#t1CreateOn').val(modify.createOn);
			
			t1Data.txOrAmt, t1Data.txQsAmt, t1Data.txReinsNo, t1Data.txReinsCl, t1Data.txReinsUw, t1Data.txDcReal, 
			t1Data.txUrAmt, t1Data.txUwclAmt, t1Data.txClclAmt, t1Data.txUwprAmt
			
			AutoNumeric.getAutoNumericElement('#t4or').set(t1Data.txOrAmt);
			AutoNumeric.getAutoNumericElement('#t4qs').set(t1Data.txQsAmt);
			AutoNumeric.getAutoNumericElement('#t4ur').set(t1Data.txUrAmt);
			AutoNumeric.getAutoNumericElement('#t4reinsNo').set(t1Data.txReinsNo);
			AutoNumeric.getAutoNumericElement('#t4reinsPremiC').set(t1Data.txReinsCl);
			AutoNumeric.getAutoNumericElement('#t4reinsPremiR').set(t1Data.txReinsUw);
			AutoNumeric.getAutoNumericElement('#t4claimsC').set(t1Data.txClclAmt);
			AutoNumeric.getAutoNumericElement('#t4claimsR').set(t1Data.txUwclAmt);
			
			oldReinsNo = t1Data.txReinsNo
		}
		
		function setT2() {
			var t2Data = modify.t2Data;
			
			if(t2Data == null)
				return null;
			
			var lostDate = '';
			if(t2Data.txLostDateStr != null)
				lostDate = t2Data.txLostDateStr;
			
			var adviceDate = '';
			if(t2Data.txAdviceDateStr != null)
				adviceDate = t2Data.txAdviceDateStr;
			
			$('#t2LostDate').val(lostDate);
			$('#t2AdviceDate').val(adviceDate);
			$('#t2UwReff').val(t2Data.txUwReff);
			AutoNumeric.getAutoNumericElement('#t2MaxDaysClaim').set(t2Data.txMaxPaid)
			$('#t2Cause').val(t2Data.txCause);
			$('#t2Details').val(t2Data.txDetails);
		}
		
		function setT3() {
			var trxTrxId = $('#t1OldTrxType').val();
			var trxVoucherId = $('#t1OldTrxVoucherId').val();
			
			var datas = {
				trxTrxId: trxTrxId,
				trxVoucherId: trxVoucherId
			}
			
			return $.ajax({type: 'POST', global: false, dataType: 'json',  
				contentType:'application/json',
				url: /*[[@{/marketing/claims-internal/get-underwriting}]]*/, 
				data: JSON.stringify(datas), 
				success: function (data) {
					setUw1(data.uw1);
					setUw2(data.uw2);
				}
			});
		}
		
		function setUw1(table) {
			var uw1Table = [];
	    	for(var i=0; i<table.length; i++) {    		
	    		var idKey = table.idKey;
	    		
	    		var type = table[i].trxInsType;
				var typeDesc = '';
				if(type != null) {
					if(type == '0')
						typeDesc = 'Lead';
					else if(type == '1')
						typeDesc = 'Co Reins';
				}
				
				var data = {
					idKey : idKey,
					trxInsId : table[i].trxInsId,
					trxInsIdDesc : table[i].trxInsIdDesc,
					trxInsType : typeDesc,
					trxInsShare : formatter_4.format(table[i].trxInsShare).replace('$', '')
				};
	    		
				uw1Table.push(data);
	    	}
	    	
	    	$('#t3Table1').bootstrapTable('load', uw1Table);
		}
		
		function setUw2(table) {
			var uw2Table = [];
	    	for(var i=0; i<table.length; i++) {    		
	    		var idKey = table.idKey;
				
				var data = {
					idKey : idKey,
					trxDate : table[i].trxDate,
					trxType : table[i].trxType,
					trxVoucherId : table[i].trxVoucherId,
					trxOldType: table[i].trxOldType,
					trxOldVoucherId : table[i].trxOldVoucherId,
					trxDescription : table[i].trxDescription,
					trxCurrId : table[i].trxCurrId,
					trxInvcAmount : formatter_2.format(table[i].trxInvcAmount).replace('$', ''),
					trxSetAmount : formatter_2.format(table[i].trxSetAmount).replace('$', '')
				};
	    		
				uw2Table.push(data);
	    	}
	    	
	    	/* $('#t3Table2').bootstrapTable('load', uw2Table); */
		}
		
		function setT4() {	   
			var t4Data = modify.t4Data;
			
			var remarks;
			var t4Table = [];
	    	var isOrderNumber = false;
			for(var i=0; i<t4Data.length; i++) {    	
	    		var id = create_UUID();
	    		var action = "<div class=\"input-group\">"
					+ "<button class=\"btn btn-danger\" onclick=\"t4RemoveData('"+id+"')\">" 
					+ "<i class=\"fa fa-trash\"></i>" 
					+ "</button>&nbsp;"
					+ "<button class=\"btn btn-primary\" onclick=\"t4EditData('"+id+"')\">" 
					+ "<i class=\"fa fa-edit\"></i>" 
					+ "</button>&nbsp;"
					
					if(t4Data[i].txDataStatus === '0')
						action += "<div class=\"custom-control custom-checkbox\">" 
								+ "<input type=\"checkbox\" class=\"custom-control-input\" name=\"t4_" + id + "\" id=\"t4_" + id + "\">"
								+ "<label class=\"custom-control-label\" for=\"t4_" + id + "\"></label>"
								+ "</div>"
								+ "</div>"
				
				var data = {
					id: id,
					no: t4Data[i].txRowNo,
					idKey: t4Data[i].idKey,
					group: t4Data[i].txCobGroupDesc,
					groupId: t4Data[i].txCobGroup,
					cobId: t4Data[i].txCoverId,
					cob: t4Data[i].txCoverIdDesc,
					typeId: t4Data[i].txClaimType,
					type: t4Data[i].txClaimTypeDesc,
					layer: t4Data[i].txLayer,
					pla: t4Data[i].txClaimPlaStr,
					dla: t4Data[i].txClaimDlaStr,
					remarks: t4Data[i].txClaimRemarks,
					statusId: t4Data[i].txDataStatus,
					status: t4Data[i].txDataStatusDesc,
					action: action
				}
	    		
				t4Table.push(data);
								
	    		remarks = t4Data[i].txMemo;
	    		
	    		if(t4Data[i].txRowNo == null)
	    			isOrderNumber = true;
			}
	    	
	    	$('#t4Table').bootstrapTable('load', t4Table);
	    	$('#t4remarks2').val(remarks);
	    	
	    	if(isOrderNumber)
	    		reorderNumberTableT4();
		}
		
		function setT5() {
			var t5Data = modify.t5Data;
			
			var t5Table = [];
	    	for(var i=0; i<t5Data.length; i++) {    		
	    		var idKey = t5Data[i].idKey;
				
				var data = {
					idKey: t5Data[i].idKey,
					txType: t5Data[i].txType,
					txVoucherId: t5Data[i].txVoucherId,
					txInsMem: t5Data[i].txInsMemo,
					txActTake: t5Data[i].txActTake,
					txDateAct: t5Data[i].txDateActFmts
				};
	    		
				t5Table.push(data);
	    	}
	    	
	    	$('#t5Table').bootstrapTable('load', t5Table);
		}
		
		function setT6() {	   
			var t6Data = modify.t6Data;
			
			var t6Table = [];
	    	for(var i=0; i<t6Data.length; i++) {    		
	    		var idKey = create_UUID();
	    		var action = "<button class=\"btn btn-danger\" onclick=\"t6RemoveData('"+idKey+"')\">" 
				+ "<i class=\"fa fa-trash\"></i>" 
				+ "</button>";
				
				var txDocIdDesc = t6Data[i].trxDocIdDesc.split("-")[0].trim();
				var txStatus = t6Data[i].trxDocIdDesc.split("-")[1].trim();
				
				var data = {
					idKey: idKey,
					txDocId: t6Data[i].trxDocId,
					txDocIdDesc: txDocIdDesc,
					txDocName: t6Data[i].trxDocName,
					txDocNameLink: t6Data[i].trxDocNameLink,
					txStatus: txStatus,
					txDocFolder: t6Data[i].trxDocFolder,
					action: action
				}
	    		
				t6Table.push(data);
	    	}
	    	
	    	$('#t6Table').bootstrapTable('load', t6Table);
	    	reorderNumberTable();
		}
		
		// ========== VALIDATION ========== //
		
		function validate() {
			var valC = validationTabClaim();
			$('#validationTabClaim').text(valC);
			
			if(valC.length>0) {
				$('#validation-modal').modal('show');
				
				return false;
			}
			
			return true;
		}
		
		function validationTabClaim() {
			var val = [];
			
			var t2LostDate = $('#t2LostDate').val();
			if(t2LostDate == "")
				val.push(" Lost Date is required");
			
			var cause = $('#t2Cause').val();
			if(cause == "")
				val.push(" Cause is required");
			
			var details = $('#t2Details').val();
			if(details == "")
				val.push(" Location is required");
			
			return val;
		}
		
		function t4Settlement() {
			var t4DataTable = $('#t4Table').bootstrapTable('getData');
			
			var t4Settlement = [];
			for(var i=0;i<t4DataTable.length;i++) {
				var id = 't4_'+t4DataTable[i].id;
				var isSettlement = $('#' + id).is(':checked');
				
				if(isSettlement)
					t4Settlement.push(t4DataTable[i]);
			} 
			
			if(t4Settlement.length == 0) {
				alert('No data selected!');
				return false;
			}
			
			var valMsg = validationSettlement();
			if(valMsg.length > 0) {
				alert(valMsg);
				return false;
			}
			
			doSettlement(t4Settlement);
			
			return true;
		}
		
		function validationSettlement() {
			var val = [];
			
			var t4date = $('#t4date').val();
			if(t4date == "")
				val.push(" Date is required");
			
			var t4bank = $('#t4bank').val();
			if(t4bank == "")
				val.push(" Bank is required");
			
			var t4reffIdIn = $('#t4reffIdIn').val();
			if(t4reffIdIn == "")
				val.push(" Reff ID (in) is required");
			
			var t4reffIdOut = $('#t4reffIdOut').val();
			if(t4reffIdOut == "")
				val.push(" Reff Out (out) is required");
			
			return val;
		}
		
		function doSettlement(t4Settlement) {
			var txVoucherId = $('#t1TxVoucherId').val();
			
			var datas = {
				txVoucherId: txVoucherId,
				t4Settlement: t4Settlement
			}
			
			return $.ajax({type: 'POST', global: false, dataType: 'json',  
				contentType:'application/json',
				url: /*[[@{/marketing/claims-internal/settlement}]]*/, 
				data: JSON.stringify(datas), 
				success: function (data) {
					alert('finish');
				}
			});
		}
		
		function back() {
			location.reload();
		}
		
		$('#btnExport').click(function() {
			var url = /*[[@{/marketing/claims-internal/export-claimslist-excel}]]*/;
			var year = $('#filterYear option:selected').val();
			var status = $('#filterStatus option:selected').val();
			
			if(year === 'ALL')
				year = '';
			
			url += '?year=' + year + '&status=' + status;
			
			window.open(url, '_blank');
		});
		
		$('#printPla').click(function() {
			var type = 'pla';
			var file = 'PRELIMINARY LOSS ADVICE';
			
			if(getIdKeyT4().length == 0) {
				alert('No data selected');
				return false;
			}
			
			doSave(true);
			
			var txVoucherId = $('#t1TxVoucherId').val();
			var params = getGroupLayerChecked();
			params.txVoucherId = txVoucherId;

			var url = /*[[@{/marketing/claims-internal/get-list-insurance}]]*/;
			$.ajax({type: 'POST', global: false, dataType: 'json', async: false,  
				contentType:'application/json',
				url: url, 
				data: JSON.stringify(params), 
				success: function (data) {
					if(data.length == 0 || data == null)
						alert("Data reinsurance not found!");
					
					for(var i=0;i<data.length;i++) {
						printDlaPla(type, file, data[i].trxInsId);
					}
				}
			});
		});
		
		$('#printDla').click(function() {
			var type = 'dla';
			var file = 'DEFINITE LOSS ADVICE';
			
			if(getIdKeyT4().length == 0) {
				alert('No data selected');
				return false;
			}
			
			doSave(true);
			
			var txVoucherId = $('#t1TxVoucherId').val();
			var params = getGroupLayerChecked();
			params.txVoucherId = txVoucherId;

			var url = /*[[@{/marketing/claims-internal/get-list-insurance}]]*/;
			$.ajax({type: 'POST', global: false, dataType: 'json', async: false,  
				contentType:'application/json',
				url: url, 
				data: JSON.stringify(params), 
				success: function (data) {
					if(data.length == 0 || data == null)
						alert("Data reinsurance not found!");
					
					for(var i=0;i<data.length;i++) {
						printDlaPla(type, file, data[i].trxInsId);
					}
				}
			});
		});
		
		$('#btnDc').click(function() {
			if(getIdKeyT4().length == 0) {
				alert('No data selected');
				return false;
			}
			
			doSave(true);
			
			var idKey = getIdKeyT4();
			var txVoucherId = $('#t1TxVoucherId').val();
			var param = {
				txVoucherId: txVoucherId,
				idKey: idKey.toString()
			}
			var url = /*[[@{/marketing/claims-internal/create-dc-notes}]]*/;
			$.ajax({type: 'POST', global: false, dataType: 'json', async: false,  
				contentType:'application/json',
				url: url, 
				data: JSON.stringify(param), 
				success: function (data) {
					for(var i=0;i<data.length;i++) {
						print(data[i]);
					}
				}
			});
		});
		
		function print(voucherId) {
			var url = /*[[@{/marketing/dc-note/view-pdf}]]*/;
			var param = '?voucherId=' + voucherId;
			
			param = encodeURI(param);
			
			window.open(url+param, '_blank');
		}
		
		function printDlaPla(type, file, insId) {
			var url = /*[[@{/marketing/claims-internal/print-pla-dla}]]*/;
			
			var txVoucherId = $('#t1TxVoucherId').val();
			var idKey = getIdKeyT4();
			var type = type;
			var file = file;
			
			url += '?type=' + type + '&file=' + file + '&txVoucherId=' + txVoucherId + '&idKey=' + idKey + '&insId=' + insId;
			
			window.open(url, '_blank');
		}
		
		function setIdKeyValue() {
			var params = new Object()
			params.txVoucherId = $('#t1TxVoucherId').val();
			params.txType = 'CS';

			var url = /*[[@{/marketing/claims-internal/get-list-value}]]*/;
			$.ajax({type: 'POST', global: false, dataType: 'json', async: false,  
				contentType:'application/json',
				url: url, 
				data: JSON.stringify(params), 
				success: function (result) {
					var listIdChecked = [];
					var t4Data = $('#t4Table').bootstrapTable('getData');
					for(var i=0;i<result.length;i++) {
						for(var j=0; j<t4Data.length; j++) {
							if(result[i].txRowNo == t4Data[j].no) {
								t4Data[j].idKey = result[i].idKey;
								
								var idChecked = "#t4_" + t4Data[j].id;
								if($(idChecked).prop("checked") == true)
									listIdChecked.push(idChecked);		
							}
						}
					}
					
					for(var i=0; i<t4Data.length; i++) {
						$('#t4Table').bootstrapTable('updateByUniqueId', {
							id: t4Data[i].id, 
							row: t4Data[i]
						});	
					}
					
					for(var i=0; i<listIdChecked.length; i++) {
						$(listIdChecked[i]).prop("checked", true);
					}
				}
			});
		}
		
		$('#btnInternalMemo').click(function() {
			createInternalMemoExcel();
			createInternalMemo();
		});
		
		function createInternalMemo() {			
			var params = new Object()
			params.startDate = $('#internalMemoStart').val();
			params.endDate = $('#internalMemoEnd').val();
			
			var url = /*[[@{/marketing/claims-internal/get-list-internalmemo}]]*/;
			$.ajax({type: 'POST', global: false, dataType: 'json', async: false,  
				contentType:'application/json',
				url: url, 
				data: JSON.stringify(params), 
				success: function (data) {					
					for(var i=0;i<data.length;i++) {
						createInternalMemoDoc(data[i].ccy, data[i].cedant, data[i].cedantName, params.startDate, params.endDate);
					}
				}
			});
		}
		
		function createInternalMemoDoc(ccy, cedant, cedantName, startDate, endDate) {			
			var url = /*[[@{/marketing/claims-internal/create-internalmemo}]]*/;
			
			var param = '?ccy=' + ccy + '&cedant=' + cedant + '&cedantName=' + cedantName + '&startDate=' + startDate + '&endDate=' + endDate;
			param = encodeURI(param);
			
			window.open(url + param, '_blank');
		}
		
		function createInternalMemoExcel() {
			var url = /*[[@{/marketing/claims-internal/create-internalmemo-excel}]]*/;
			var startDate = $('#internalMemoStart').val();
			var endDate = $('#internalMemoEnd').val();
			
			var param = '?startDate=' + startDate + '&endDate=' + endDate;
			param = encodeURI(param);
			
			window.open(url + param, '_blank');
		}
		
	/*]]>*/
</script>

</html>