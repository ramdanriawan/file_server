CREATE OR REPLACE VIEW `VIEW_LAPORAN_VAT` AS SELECT
    `tr12`.`ID_KEY` AS `ID_KEY`,
    DATE_FORMAT(`tr12`.`TRX_DATE`, '%m') AS `MONTH`,
    `tr12`.`TRX_DATE` AS `TRX_DATE`,
    DATE_FORMAT(`tr12`.`TRX_DATE`, '%d %M %Y') AS `FORMATED_DATE`,
    CONCAT(
        `tr12`.`TRX_TYPE`,' - ',
        `tr12`.`TRX_VOUCHER_ID`,' - RQ ',
	   `tr12`.`TRX_OLD_VOUCHER_ID`
    ) AS `INVOICE`,
    CASE WHEN `tr12`.`TRX_SOURCE` IN('0', '1') THEN 'PROD' WHEN `tr12`.`TRX_SOURCE` = '2' AND `tr12`.`TRX_DESCRIPTION` LIKE '%Endorsement - DED%' THEN 'END-D' WHEN `tr12`.`TRX_SOURCE` = '2' AND `tr12`.`TRX_DESCRIPTION` LIKE '%Endorsement - ADD%' THEN 'END-A'
END AS `TYPE`,
CONCAt((
    SELECT
        `ma5`.`CLI_NAME`
    FROM
        `MA0005` `ma5`
    WHERE
        `ma5`.`CLI_CODE` = `tr12`.`TRX_CLIENT`
),' - Policy No. : ',
         `tr6a`.`TRX_REMARKS`
) AS `ACCOUNT`,
`tr12`.`TRX_CURR_ID` AS `CURR`,
`tr12`.`TRX_CURR_RATE` AS `KMK_RATE`,
CASE WHEN `tr12`.`TRX_DESCRIPTION` LIKE '%Endorsement - DED%' THEN CONCAT('(', `tr12`.`TRX_BRKR_FEE`, ')') ELSE `tr12`.`TRX_BRKR_FEE`
END AS `ORIGINAL_AMOUNT_CGOS`,
CASE WHEN `tr12`.`TRX_DESCRIPTION` LIKE '%Endorsement - DED%' THEN CONCAT('-', `tr12`.`TRX_BRKR_FEE`) ELSE `tr12`.`TRX_BRKR_FEE`
END AS `ORIGINAL_AMOUNT_CGOS_ORG`,
CASE WHEN `tr12`.`TRX_DESCRIPTION` LIKE '%Endorsement - DED%' THEN CONCAT('(', `tr12`.`TRX_TAXIN_BF`, ')') ELSE `tr12`.`TRX_TAXIN_BF`
END AS `ORIGINAL_AMOUNT_VAT`,
CASE WHEN `tr12`.`TRX_DESCRIPTION` LIKE '%Endorsement - DED%' THEN CONCAT('-', `tr12`.`TRX_TAXIN_BF`) ELSE `tr12`.`TRX_TAXIN_BF`
END AS `ORIGINAL_AMOUNT_VAT_ORG`,
CASE WHEN `tr12`.`TRX_DESCRIPTION` LIKE '%Endorsement - DED%' THEN CONCAT(
    '(',
    `tr12`.`TRX_BRKR_FEE` * `tr12`.`TRX_CURR_RATE`,
    ')'
) ELSE `tr12`.`TRX_BRKR_FEE` * `tr12`.`TRX_CURR_RATE`
END AS `IDR_AMOUNT_CGOS`,
CASE WHEN `tr12`.`TRX_DESCRIPTION` LIKE '%Endorsement - DED%' THEN CONCAT(
    '-',
    `tr12`.`TRX_BRKR_FEE` * `tr12`.`TRX_CURR_RATE`
) ELSE `tr12`.`TRX_BRKR_FEE` * `tr12`.`TRX_CURR_RATE`
END AS `IDR_AMOUNT_CGOS_ORG`,
CASE WHEN `tr12`.`TRX_DESCRIPTION` LIKE '%Endorsement - DED%' THEN CONCAT(
    '(',
    `tr12`.`TRX_TAXIN_BF` * `tr12`.`TRX_CURR_RATE`,
    ')'
) ELSE `tr12`.`TRX_TAXIN_BF` * `tr12`.`TRX_CURR_RATE`
END AS `IDR_AMOUNT_VAT`,
CASE WHEN `tr12`.`TRX_DESCRIPTION` LIKE '%Endorsement - DED%' THEN CONCAT(
    '-',
    `tr12`.`TRX_TAXIN_BF` * `tr12`.`TRX_CURR_RATE`
) ELSE `tr12`.`TRX_TAXIN_BF` * `tr12`.`TRX_CURR_RATE`
END AS `IDR_AMOUNT_VAT_ORG`
FROM
    `TR0012` `tr12`, `TR0006A`  `tr6a`
WHERE
    `tr12`.`TRX_DATA_STATUS` IN('11', '13') AND `tr12`.`TRX_SOURCE` IN('0', '1', '2') AND `tr12`.`TRX_TYPE` IN('PU', 'SE') AND `tr12`.`TRX_BRKR_FEE` > 0 and `tr6a`.`TRX_VOUCHER_ID`= `tr12`.`TRX_OLD_VOUCHER_ID`
ORDER BY
    `tr12`.`TRX_DATE`;
